{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Accounts Management - MadBoost Admin{% endblock %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/madboost-admin.css' %}">
{% endblock %}

{% block content %}
<div class="accounts-container">
    <!-- Accounts Header -->
    <div class="accounts-header">
        <h1><i class="fas fa-users"></i> Accounts Management</h1>
        <div class="accounts-summary">
            <div class="summary-item">
                <span class="summary-number">{{ total_users }}</span>
                <span class="summary-label">Total Users</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ total_boosters }}</span>
                <span class="summary-label">Boosters</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ total_clients }}</span>
                <span class="summary-label">Clients</span>
            </div>
            <div class="summary-item">
                <span class="summary-number">{{ total_managers }}</span>
                <span class="summary-label">Managers</span>
            </div>
        </div>
    </div>

    <!-- Account Status Overview -->
    <div class="row">
        <div class="col-md-3">
            <div class="status-card status-active">
                <div class="status-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-content">
                    <div class="status-number">{{ active_accounts }}</div>
                    <div class="status-label">Active Accounts</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="status-card status-inactive">
                <div class="status-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="status-content">
                    <div class="status-number">{{ inactive_accounts }}</div>
                    <div class="status-label">Inactive Accounts</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="status-card status-verified">
                <div class="status-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="status-content">
                    <div class="status-number">{{ verified_accounts }}</div>
                    <div class="status-label">Verified Accounts</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="status-card status-unverified">
                <div class="status-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="status-content">
                    <div class="status-number">{{ unverified_accounts }}</div>
                    <div class="status-label">Unverified Accounts</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Accounts Navigation Tabs -->
    <div class="accounts-tabs">
        <ul class="nav nav-tabs" id="accountsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="boosters-tab" data-bs-toggle="tab" data-bs-target="#boosters" type="button" role="tab">
                    <i class="fas fa-trophy"></i> Boosters
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="clients-tab" data-bs-toggle="tab" data-bs-target="#clients" type="button" role="tab">
                    <i class="fas fa-users"></i> Clients
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="managers-tab" data-bs-toggle="tab" data-bs-target="#managers" type="button" role="tab">
                    <i class="fas fa-crown"></i> Managers
                </button>
            </li>
        </ul>

        <div class="tab-content" id="accountsTabsContent">
            <!-- Boosters Tab -->
            <div class="tab-pane fade show active" id="boosters" role="tabpanel">
                <div class="tab-header">
                    <h3>Booster Accounts</h3>
                    <div class="tab-actions">
                        <button class="btn btn-success" onclick="addBooster()">
                            <i class="fas fa-plus"></i> Add Booster
                        </button>
                        <button class="btn btn-primary" onclick="exportBoosters()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Booster Filters -->
                <div class="filters-section">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control admin-search" placeholder="Search boosters..." data-target="boosters">
                        </div>
                        <div class="col-md-3">
                            <select class="form-control admin-filter" data-filter="game">
                                <option value="">All Games</option>
                                <option value="csgo2">CS:GO 2</option>
                                <option value="dota2">Dota 2</option>
                                <option value="lol">League of Legends</option>
                                <option value="valorant">Valorant</option>
                                <option value="overwatch2">Overwatch 2</option>
                                <option value="pubg">PUBG</option>
                                <option value="rocketLeague">Rocket League</option>
                                <option value="hearthstone">Hearthstone</option>
                                <option value="wow">World of Warcraft</option>
                                <option value="tft">Teamfight Tactics</option>
                                <option value="mobileLegends">Mobile Legends</option>
                                <option value="honorOfKings">Honor of Kings</option>
                                <option value="wildRift">Wild Rift</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-control admin-filter" data-filter="status">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary btn-block" onclick="applyFilters()">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Boosters Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Specialization</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Earnings</th>
                                <th>Orders</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="boosters-table-body">
                            <!-- Boosters will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Clients Tab -->
            <div class="tab-pane fade" id="clients" role="tabpanel">
                <div class="tab-header">
                    <h3>Client Accounts</h3>
                    <div class="tab-actions">
                        <button class="btn btn-primary" onclick="exportClients()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Client Filters -->
                <div class="filters-section">
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control admin-search" placeholder="Search clients..." data-target="clients">
                        </div>
                        <div class="col-md-4">
                            <select class="form-control admin-filter" data-filter="status">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary btn-block" onclick="applyFilters()">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Clients Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Total Spent</th>
                                <th>Orders</th>
                                <th>Last Order</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clients-table-body">
                            <!-- Clients will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Managers Tab -->
            <div class="tab-pane fade" id="managers" role="tabpanel">
                <div class="tab-header">
                    <h3>Manager Accounts</h3>
                    <div class="tab-actions">
                        <button class="btn btn-success" onclick="addManager()">
                            <i class="fas fa-plus"></i> Add Manager
                        </button>
                        <button class="btn btn-primary" onclick="exportManagers()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Managers Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Active</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="managers-table-body">
                            <!-- Managers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Booster Modal -->
<div class="modal fade" id="boosterModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="boosterModalTitle">Add New Booster</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="boosterForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control" name="username" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-control" name="email" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Specialization</label>
                                <select class="form-control" name="specialization" required>
                                    <option value="">Select Game</option>
                                    <option value="csgo2">CS:GO 2</option>
                                    <option value="dota2">Dota 2</option>
                                    <option value="lol">League of Legends</option>
                                    <option value="valorant">Valorant</option>
                                    <option value="overwatch2">Overwatch 2</option>
                                    <option value="pubg">PUBG</option>
                                    <option value="rocketLeague">Rocket League</option>
                                    <option value="hearthstone">Hearthstone</option>
                                    <option value="wow">World of Warcraft</option>
                                    <option value="tft">Teamfight Tactics</option>
                                    <option value="mobileLegends">Mobile Legends</option>
                                    <option value="honorOfKings">Honor of Kings</option>
                                    <option value="wildRift">Wild Rift</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Commission %</label>
                                <input type="number" class="form-control" name="commission" min="0" max="100" value="70" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Comments</label>
                        <textarea class="form-control" name="comments" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveBooster()">Save Booster</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Manager Modal -->
<div class="modal fade" id="managerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="managerModalTitle">Add New Manager</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="managerForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" name="username" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select class="form-control" name="role" required>
                            <option value="">Select Role</option>
                            <option value="support">Support Manager</option>
                            <option value="operations">Operations Manager</option>
                            <option value="quality">Quality Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Comments</label>
                        <textarea class="form-control" name="comments" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveManager()">Save Manager</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
{{ block.super }}
<script src="{% static 'admin/js/madboost-admin.js' %}"></script>
<script>
// Accounts management JavaScript
document.addEventListener('DOMContentLoaded', function() {
    loadBoosters();
    loadClients();
    loadManagers();
});

function loadBoosters() {
    fetch('{% url "admin_dashboard:booster_accounts" %}')
        .then(response => response.text())
        .then(html => {
            // Parse and display boosters
            displayBoosters(html);
        })
        .catch(error => {
            console.log('Error loading boosters:', error);
        });
}

function loadClients() {
    fetch('{% url "admin_dashboard:client_accounts" %}')
        .then(response => response.text())
        .then(html => {
            // Parse and display clients
            displayClients(html);
        })
        .catch(error => {
            console.log('Error loading clients:', error);
        });
}

function loadManagers() {
    fetch('{% url "admin_dashboard:manager_accounts" %}')
        .then(response => response.text())
        .then(html => {
            // Parse and display managers
            displayManagers(html);
        })
        .catch(error => {
            console.log('Error loading managers:', error);
        });
}

function addBooster() {
    $('#boosterModalTitle').text('Add New Booster');
    $('#boosterForm')[0].reset();
    $('#boosterModal').modal('show');
}

function addManager() {
    $('#managerModalTitle').text('Add New Manager');
    $('#managerForm')[0].reset();
    $('#managerModal').modal('show');
}

function saveBooster() {
    const formData = new FormData(document.getElementById('boosterForm'));
    
    fetch('{% url "admin_dashboard:booster_accounts" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCSRFToken()
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('Booster added successfully!', 'success');
            $('#boosterModal').modal('hide');
            loadBoosters();
        } else {
            showNotification('Error adding booster', 'error');
        }
    })
    .catch(error => {
        console.log('Error:', error);
        showNotification('Error adding booster', 'error');
    });
}

function saveManager() {
    const formData = new FormData(document.getElementById('managerForm'));
    
    fetch('{% url "admin_dashboard:manager_accounts" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCSRFToken()
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('Manager added successfully!', 'success');
            $('#managerModal').modal('hide');
            loadManagers();
        } else {
            showNotification('Error adding manager', 'error');
        }
    })
    .catch(error => {
        console.log('Error:', error);
        showNotification('Error adding manager', 'error');
    });
}

function applyFilters() {
    // Apply filters logic
    const filters = {
        game: document.querySelector('[data-filter="game"]').value,
        status: document.querySelector('[data-filter="status"]').value
    };
    
    // Reload data with filters
    loadBoosters();
}

function exportBoosters() {
    showNotification('Export feature coming soon!', 'info');
}

function exportClients() {
    showNotification('Export feature coming soon!', 'info');
}

function exportManagers() {
    showNotification('Export feature coming soon!', 'info');
}

function getCSRFToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
}

function showNotification(message, type) {
    if (window.MadBoostAdmin && window.MadBoostAdmin.showNotification) {
        window.MadBoostAdmin.showNotification(message, type);
    } else {
        alert(message);
    }
}
</script>
{% endblock %} 