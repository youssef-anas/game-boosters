{% extends 'layouts/base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Game Boosters{% endblock %}
{% block style %}
<link rel="stylesheet" href="{% static 'booster/css/edit-profile.css' %}">
<link rel="stylesheet" href="{% static 'base/css/fields.css' %}">
{% endblock %}
{% block container %}
<div class="container">
  <h2>Edit Profile</h2>
  
  <!-- Display success message -->
  {% if messages %}
      {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
              {{ message }}
          </div>
      {% endfor %}
  {% endif %}
  
  <!-- Profile Edit Form -->
  <form method="POST">
      {% csrf_token %}
      
      <!-- Render email field -->
      <div class="form-group">
          <label for="id_email">Email</label>
          {{ profile_form.email }}
          {% if profile_form.email.errors %}
              <div class="alert alert-danger">
                  {{ profile_form.email.errors }}
              </div>
          {% endif %}
      </div>
      
      <!-- Render username field -->
      <div class="form-group">
          <label for="id_username">Username</label>
          {{ profile_form.username }}
          {% if profile_form.username.errors %}
              <div class="alert alert-danger">
                  {{ profile_form.username.errors }}
              </div>
          {% endif %}
      </div>
      
      <!-- Render country field -->
      <div class="form-group">
          <label for="id_country">Country</label>
          {{ profile_form.country }}
          {% if profile_form.country.errors %}
              <div class="alert alert-danger">
                  {{ profile_form.country.errors }}
              </div>
          {% endif %}
      </div>
      
      <!-- Render date of birth fields (day, month, year) -->
      <div class="form-group">
          <label for="id_date_of_birth">Date of Birth</label>
          <div class="dob-group">
              <div class="dob-item">
                  <label for="birth_day">Day:</label>
                  {{ profile_form.birth_day }}
              </div>
              <div class="dob-item">
                  <label for="birth_month">Month:</label>
                  {{ profile_form.birth_month }}
              </div>
              <div class="dob-item">
                  <label for="birth_year">Year:</label>
                  {{ profile_form.birth_year }}
              </div>
          </div>
          {% if profile_form.birth_day.errors or profile_form.birth_month.errors or profile_form.birth_year.errors %}
              <div class="alert alert-danger">
                  {{ profile_form.birth_day.errors }}
                  {{ profile_form.birth_month.errors }}
                  {{ profile_form.birth_year.errors }}
              </div>
          {% endif %}
      </div>
      
      <!-- Submit button for profile form -->
      <button type="submit" name="profile_submit" class="btn btn-primary">Update Profile</button>
  </form>
  
  <!-- Password Change Form (Optional) -->
  {% if password_form %}
      <h3>Change Password</h3>
      <form method="POST">
          {% csrf_token %}
          {{ password_form.as_p }}
          
          <!-- Submit button for password form -->
          <button type="submit" name="password_submit" class="btn btn-secondary">Change Password</button>
      </form>
  {% endif %}
  
  <!-- Email Edit Form (Optional) -->
  {% if email_edit_form %}
      <h3>Edit Email</h3>
      <form method="POST">
          {% csrf_token %}
          
          <!-- Render old email and new email fields -->
          <div class="form-group">
              <label for="id_old_email">Current Email:</label>
              {{ email_edit_form.old_email }}
              {% if email_edit_form.old_email.errors %}
                  <div class="alert alert-danger">
                      {{ email_edit_form.old_email.errors }}
                  </div>
              {% endif %}
          </div>
          
          <div class="form-group">
              <label for="id_new_email">New Email:</label>
              {{ email_edit_form.new_email }}
              {% if email_edit_form.new_email.errors %}
                  <div class="alert alert-danger">
                      {{ email_edit_form.new_email.errors }}
                  </div>
              {% endif %}
          </div>
          
          <!-- Submit button for email form -->
          <button type="submit" name="email_submit" class="btn btn-primary">Update Email</button>
      </form>
  {% endif %}
</div>
<div class="edit-container p-lg-5 p-0 text-white" style="padding-top: 6rem !important;">
  {% if messages %}
    {% for message in messages %}
      <div class="py-3 mx-auto" style="width: 550px;">
        <div class="alert {{ message.tags }} alert-dismissible mb-0 message" role="alert" >
          {{ message }}
        </div>
      </div>
    {% endfor %}
  {% endif %}
  <div class="container edit">
    <div class="header text-center">
      <h2>Edit Your Profile</h2>
      <p class="text-secondary fs-5">Here you can find out all of the information about your account status and set your preferences</p>
    </div>
    <div class="row justify-content-between my-5">

      <div class="col-lg-3 col-12 mb-lg-0 mb-4 information text-center p-5">
        <div class="image mx-auto">
          {% if request.user.image %}
          <img src="{{ request.user.image.url }}" class="image"  alt="Profile Photo"/>
          {% else %}
          <img src="{% static 'base/images/no_profile_image.png' %}" class="image" alt="No Profile Photo">
          {% endif %}
        </div>

        <div class="name">
          <p class="my-4">{{request.user.first_name}} {{request.user.last_name}}</p>
        </div>
        
       

        <hr>

        <div class="info">
          <p>{{request.user.username}}</p>
          <p>{{request.user.email}}</p>
        </div>

        <!-- <div class="design-image d-lg-block d-none">
          <img src="{% static 'booster/images/char.png' %}" alt="">
        </div> -->
      </div>

      <div class="col-lg-8 col-12 fields p-5">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ profile_form.as_p }}
          <button type="submit" name="profile_submit" class="btn fs-5 text-white rounded-5 px-4 py-2 mt-3" style="background-image: linear-gradient(to right, #15053C 0%, #9303B6 50%, #4A0774)">Save Profile Changes</button>
        </form>
      </div>

    </div>
    
    <div class="row change-password p-5 mx-lg-auto mx-0">
      <div class="content">
        <h2>Change Password</h2>
          <form method="post">
            {% csrf_token %}
            {{ password_form.as_p }}
            <button type="submit" name="password_submit" class="btn fs-5 text-white rounded-5 px-4 py-2 mt-3" style="background-image: linear-gradient(to right, #15053C 0%, #9303B6 50%, #4A0774)">Change Password</button>
          </form>
        </div>
      </div>
    </div>  

  </div>
</div>
{% endblock %}
{% block script %}
<script>
  var oldPasswordInput = document.getElementById('id_old_password');
  oldPasswordInput.blur();
</script>
{% endblock %}